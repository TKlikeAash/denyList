<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #preview canvas{
      width: 100%;
      max-width: 500px;
    }
  </style>
</head>
<body>
  <input type="file" id="fileInput" accept="image/*" onchange="processImage()">
  <label for="blurRadius">模糊程度：</label>
  <input type="range" id="blurRadius" min="0" max="15" step="1" value="0">
  <span id="blurRadiusValue">0</span>
  <div id="preview"></div>
  <script>
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const blurRadiusInput = document.getElementById('blurRadius');
    const blurRadiusValue = document.getElementById('blurRadiusValue');
    // 添加 input 事件监听器来实时更新模糊效果
    blurRadiusInput.addEventListener('input', function () {
      blurRadiusValue.textContent = blurRadiusInput.value; // 更新模糊程度的值显示
      processImage(); // 实时处理并预览图像
    });

    function processImage() {
      if (fileInput.files.length > 0) {
        const uploadedImage = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function (e) {
          const img = new Image();
          img.src = e.target.result;

          img.onload = function () {
            const blurRadius = parseInt(blurRadiusInput.value); // 获取用户输入的模糊程度
            
            // 在这里添加代码来模糊化图片
            const blurredImage = applyBlurEffect(img, blurRadius); // 使用用户输入的模糊程度
            
            // 创建一个临时链接以便下载图片
            const downloadLink = document.createElement('a');
            downloadLink.href = blurredImage.toDataURL(); // 将模糊化后的图片转换为数据URL
            downloadLink.download = 'blurred_image.png'; // 下载文件的名称
            downloadLink.textContent = '下載';
            downloadLink.style.display = 'block';
            
            // 将模糊化后的图片显示在预览中
            preview.innerHTML = '';
            preview.appendChild(blurredImage);
            preview.appendChild(downloadLink);
          };
        };

        reader.readAsDataURL(uploadedImage); // 读取上传的图片
      }
    }

    function applyBlurEffect(image, blurRadius) {
      // 在这里添加代码来模糊化图片，使用用户输入的模糊程度
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = image.width;
      canvas.height = image.height;
      context.filter = `blur(${blurRadius}px)`; // 使用用户输入的模糊程度
      context.drawImage(image, 0, 0);
      return canvas;
    }
  </script>
</body>
</html>